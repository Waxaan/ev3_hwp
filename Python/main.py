#!/usr/bin/env python3
from ev3dev2.motor import LargeMotor, OUTPUT_A, OUTPUT_C, OUTPUT_D, SpeedPercent, MoveTank, MediumMotor
from ev3dev2.button import Button
from ev3dev2.led import Leds

import time

def getPic(index=0): #x = x_diff, y = y_diff, r = raised 
    pics = [
        [{"x": 1.493, "y": 9.958, "r": 0}, {"x": 1.992, "y": 9.211, "r": 0}, {"x": 1.743, "y": 10.955, "r": 0}, {"x": 1.743, "y": 9.709, "r": 0}, {"x": 1.742, "y": 5.976, "r": 0}, {"x": 0.498, "y": -4.98, "r": 0}, {"x": 0.0, "y": -20.415, "r": 0}, {"x": 0.0, "y": -14.44, "r": 0}, {"x": 0.498, "y": -10.705, "r": 0}, {"x": 0.996, "y": -4.481, "r": 0}, {"x": 0.996, "y": -3.237, "r": 0}, {"x": 2.49, "y": 1.992, "r": 0}, {"x": 6.473, "y": 19.917, "r": 0}, {"x": 6.224, "y": 20.166, "r": 0}, {"x": 6.721, "y": 13.942, "r": 0}, {"x": 1.992, "y": 3.984, "r": 0}], 
        [{"x": 1.366, "y": -7.805, "r": 0}, {"x": 1.366, "y": -7.024, "r": 0}, {"x": 0.976, "y": -6.829, "r": 0}, {"x": 0.975, "y": -3.317, "r": 0}, {"x": 1.756, "y": -4.878, "r": 0}, {"x": 0.781, "y": -4.683, "r": 0}, {"x": 1.561, "y": -5.659, "r": 0}, {"x": 2.341, "y": -2.732, "r": 0}, {"x": 3.122, "y": 0.391, "r": 0}, {"x": 4.098, "y": 6.829, "r": 0}, {"x": 3.512, "y": 7.219, "r": 0}, {"x": 2.926, "y": 6.049, "r": 0}, {"x": 3.318, "y": 6.634, "r": 0}, {"x": 4.585, "y": 8.195, "r": 0}, {"x": 4.39, "y": 8.391, "r": 0}, {"x": 2.927, "y": 4.878, "r": 0}], 
        [{"x": 1.938, "y": 7.752, "r": 0}, {"x": 2.315, "y": 7.214, "r": 0}, {"x": 1.938, "y": 6.891, "r": 0}, {"x": 1.292, "y": 5.492, "r": 0}, {"x": 2.369, "y": 6.891, "r": 0}, {"x": 2.584, "y": 5.922, "r": 0}, {"x": 1.077, "y": 1.938, "r": 0}, {"x": 1.077, "y": 0.646, "r": 0}, {"x": 4.953, "y": 0.43, "r": 0}, {"x": 6.891, "y": 0.431, "r": 0}, {"x": -18.089, "y": -18.735, "r": 1}, {"x": 1.292, "y": -0.215, "r": 0}, {"x": 8.398, "y": 1.077, "r": 0}, {"x": 8.183, "y": 1.292, "r": 0}, {"x": 8.183, "y": -0.646, "r": 0}, {"x": 5.599, "y": 1.938, "r": 0}], 
        [{"x": -4.148, "y": 1.482, "r": 0}, {"x": -4.445, "y": 0.592, "r": 0}, {"x": -6.815, "y": 0.0, "r": 0}, {"x": -6.814, "y": 0.0, "r": 0}, {"x": -6.223, "y": -3.555, "r": 0}, {"x": -6.814, "y": -9.482, "r": 0}, {"x": -3.852, "y": -10.667, "r": 0}, {"x": -0.889, "y": -9.481, "r": 0}, {"x": 0.0, "y": -4.741, "r": 0}, {"x": 0.0, "y": -4.444, "r": 0}, {"x": 2.37, "y": -3.852, "r": 0}, {"x": 3.852, "y": -2.667, "r": 0}, {"x": 5.037, "y": -1.481, "r": 0}, {"x": 5.333, "y": 0.0, "r": 0}, {"x": 9.482, "y": 0.0, "r": 0}, {"x": 11.259, "y": 4.741, "r": 0}], 
        [{"x": -0.348, "y": -5.826, "r": 0}, {"x": -0.696, "y": -4.261, "r": 0}, {"x": -1.043, "y": -5.565, "r": 0}, {"x": -1.391, "y": -4.174, "r": 0}, {"x": -0.696, "y": -4.869, "r": 0}, {"x": -2.783, "y": -5.218, "r": 0}, {"x": -1.738, "y": -5.565, "r": 0}, {"x": -3.132, "y": -4.869, "r": 0}, {"x": -2.26, "y": -4.696, "r": 0}, {"x": -1.913, "y": -3.652, "r": 0}, {"x": -4.869, "y": -2.087, "r": 0}, {"x": -4.87, "y": -1.043, "r": 0}, {"x": -5.739, "y": 1.565, "r": 0}, {"x": -3.478, "y": 4.261, "r": 0}, {"x": -2.174, "y": 3.999, "r": 0}, {"x": -2.87, "y": 4.783, "r": 0}], 
        [{"x": 4.193, "y": 15.484, "r": 0}, {"x": 2.581, "y": 12.258, "r": 0}, {"x": 0.968, "y": 5.807, "r": 0}, {"x": 2.903, "y": 2.58, "r": 0}, {"x": 11.29, "y": 0.0, "r": 0}, {"x": 8.065, "y": -3.871, "r": 0}, {"x": -2.258, "y": -9.676, "r": 0}, {"x": -12.258, "y": -6.13, "r": 0}, {"x": -9.033, "y": 0.0, "r": 0}, {"x": 3.871, "y": 2.258, "r": 0}, {"x": 10.0, "y": -2.258, "r": 0}, {"x": 9.355, "y": -8.387, "r": 0}, {"x": -1.935, "y": -14.194, "r": 0}, {"x": -10.323, "y": -10.645, "r": 0}, {"x": -11.613, "y": -1.29, "r": 0}, {"x": -15.806, "y": 3.548, "r": 0}], 
        [{"x": 6.432, "y": 0.201, "r": 0}, {"x": 5.829, "y": 0.804, "r": 0}, {"x": 6.232, "y": 0.0, "r": 0}, {"x": 6.633, "y": 0.804, "r": 0}, {"x": 2.211, "y": 0.804, "r": 0}, {"x": -10.251, "y": -6.834, "r": 0}, {"x": -14.874, "y": -12.663, "r": 0}, {"x": -7.237, "y": -6.835, "r": 0}, {"x": -3.819, "y": -2.814, "r": 0}, {"x": -1.407, "y": -1.005, "r": 0}, {"x": -2.01, "y": -1.809, "r": 0}, {"x": 1.005, "y": -1.206, "r": 0}, {"x": 11.658, "y": 1.809, "r": 0}, {"x": 11.056, "y": 2.01, "r": 0}, {"x": 9.447, "y": 1.809, "r": 0}, {"x": 6.834, "y": -2.814, "r": 0}], 
        [{"x": -4.03, "y": 1.151, "r": 0}, {"x": -6.906, "y": 1.439, "r": 0}, {"x": -4.893, "y": 0.0, "r": 0}, {"x": -4.891, "y": -0.288, "r": 0}, {"x": -11.223, "y": -14.1, "r": 0}, {"x": -4.03, "y": -10.936, "r": 0}, {"x": -0.287, "y": -6.906, "r": 0}, {"x": 3.165, "y": -7.195, "r": 0}, {"x": 11.223, "y": -1.726, "r": 0}, {"x": 10.936, "y": 2.302, "r": 0}, {"x": 9.784, "y": 10.36, "r": 0}, {"x": 2.878, "y": 4.028, "r": 0}, {"x": 0.575, "y": -5.179, "r": 0}, {"x": -12.086, "y": 1.726, "r": 1}, {"x": 4.028, "y": 1.439, "r": 0}, {"x": 9.497, "y": 2.302, "r": 0}], 
        [{"x": -3.005, "y": 3.237, "r": 0}, {"x": -1.619, "y": 4.393, "r": 0}, {"x": 0.462, "y": 8.555, "r": 0}, {"x": 3.237, "y": 7.63, "r": 0}, {"x": 4.624, "y": 6.936, "r": 0}, {"x": 4.856, "y": 3.932, "r": 0}, {"x": 9.017, "y": 4.161, "r": 0}, {"x": 7.4, "y": -1.387, "r": 0}, {"x": 3.699, "y": -5.78, "r": 0}, {"x": 0.462, "y": -9.481, "r": 0}, {"x": -3.237, "y": -8.323, "r": 0}, {"x": -6.012, "y": -6.012, "r": 0}, {"x": -6.936, "y": -7.168, "r": 0}, {"x": -6.011, "y": -3.005, "r": 0}, {"x": 28.439, "y": 49.48, "r": 1}, {"x": 0.0, "y": -1.85, "r": 0}], 
        [{"x": 2.395, "y": 9.581, "r": 0}, {"x": 5.03, "y": 11.497, "r": 0}, {"x": 3.832, "y": 6.946, "r": 0}, {"x": 1.917, "y": 1.916, "r": 0}, {"x": 0.718, "y": -13.174, "r": 0}, {"x": 0.24, "y": -16.766, "r": 0}, {"x": 0.479, "y": -10.539, "r": 0}, {"x": 0.718, "y": -2.635, "r": 0}, {"x": 1.677, "y": -1.916, "r": 0}, {"x": 7.425, "y": 16.766, "r": 0}, {"x": 10.539, "y": 19.881, "r": 0}, {"x": 3.353, "y": 6.946, "r": 0}, {"x": 1.677, "y": -3.353, "r": 0}, {"x": -0.479, "y": -14.611, "r": 0}, {"x": -1.677, "y": -17.485, "r": 0}, {"x": -2.874, "y": -5.988, "r": 0}],        
        [{"x": 10, "y": 10, "r": 0}, {"x": 9, "y": 9, "r": 0}, {"x": -20, "y": -20, "r": 1}, {"x": 5, "y": -5, "r": 0}]]

    pic = pics[index]

    x_max = 0.0
    x_min = 0.0
    y_max = 0.0
    y_min = 0.0
    x_sum = 0.0
    y_sum = 0.0
    for p in pic:
        x_sum += p['x']
        if x_sum > x_max:
            x_max = x_sum
        if x_sum < x_min:
            x_min = x_sum

        y_sum += p['y']
        if y_sum > y_max:
            x_max = y_sum
        if y_sum < y_min:
            y_min = y_sum

    return pic, x_min, x_max, y_min, y_max


def main():
    print('Hello World!')
    btn = Button

    tank_drive = MoveTank(OUTPUT_A, OUTPUT_D)
    Fahrwerk = LargeMotor(OUTPUT_D)
    Stift = MediumMotor(OUTPUT_C)
    Kette = LargeMotor(OUTPUT_A)
    # drive in a turn for 5 rotations of the outer motor
    # the first two parameters can be unit classes or percentages.

    pic, x_min, x_max, y_offset, y_max = getPic(5)
#########
    x_scaling = 1.0
    y_scaling = 1.0

    #constraints for the chain-movement
    if x_max > 20:
        x_scaling = 20/x_max
    if x_min < -20:
        x_scaling = 20/x_max
    x_offset = x_max + x_min

    #constraints for the chain-movement
    if y_max > 32:
        y_scaling = 32/y_max

    Fahrwerk.on_for_seconds(SpeedPercent(y_offset*(-2)), 1)

    for p in pic:
        print('x: {}, y:{}, r:{}'.format(p['x'], p['y'], p['r']))
        if not p['r']:
            Stift.on_for_seconds(SpeedPercent(10), 1)

        tank_drive.on_for_seconds(SpeedPercent(p['x'] * x_scaling), SpeedPercent(p['y'] * y_scaling), 1)

        if not p['r']:
            Stift.on_for_seconds(SpeedPercent(-10), 1)

        time.sleep(1)
    
    Kette.on_for_seconds(SpeedPercent(x_offset*(-1)), 1)

    time.sleep(5)


if __name__ == '__main__':
    main()
